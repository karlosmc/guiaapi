<?php

use chriskacerguis\RestServer\RestController;
use Ejecucion\Certificar;
use Ejecucion\Serializar;
use Models\Sender\RequestSign;

defined('BASEPATH') OR exit('No direct script access allowed');

include_once './vendor/autoload.php';

// require('Ejecucion\Serializar.php');
//require('Ejecucion\Certificar.php');
require('Ejecucion/Certificar.php');
require('Models\Sender\RequestSign.php');




class FirmarXml extends RestController
{
	public function __construct()
	{
        parent::__construct();
        
       /*  $this->load->model('Sale/DocumentoElectronico','DE');
        $this->load->model('Sale/Contribuyente','CO');
        $this->load->model('Sale/leyenda');
        $this->load->helper('mostrar');
        $this->load->model('Sale/item');
        $this->load->library('twig'); */

        
    }
    function index_get($doc){
        echo $doc;

        // $Ejecutar=new Serializar;
        
        // $resp=$Ejecutar->GenerarXmlFactura($doc);
        // $this->response(array($resp), 200);
    }

    function index_post(){
        
        
        // $sign=$this->post('sign');

        $sign = json_decode(file_get_contents("php://input"),true);
        
        // $cer = "QmFnIEF0dHJpYnV0ZXMNCiAgICBsb2NhbEtleUlEOiBBNSA4OCA5MyA4OCBGMCA4MyAxRiA3NSBCMSBDRSA4NSBBNyBENyA1NCA4NiBEOSA4NCA5QyBENCBCOSANCiAgICBmcmllbmRseU5hbWU6IDIwNTE5NjY2NjAxXzAwNTA5OTEwDQpzdWJqZWN0PXN0cmVldCA9IEFWLiBDSVJDVU5WQUxBQ0lPTiBOT1JURSBMVC4gMTQgTVouIFxDM1w5MSBVUkIuIFJBTU9OIENPUEFKQSwgZW1haWxBZGRyZXNzID0gdmVudGFzY29ycEBqY2hsbGFudGFzLmNvbS5wZSwgQ04gPSBTT0ZUV0FSRSBERSBGQUNUVVJBQ0lPTiBFTEVDVFJPTklDQSwgT1UgPSBGQUNUVVJBIEVMRUNUUk9OSUNBIFJVQyAyMDUxOTY2NjYwMSwgT1UgPSBWYWxpZGFkbyBwb3IgTGxhbWEucGUgRVIsIE8gPSBBR1JPUEVDVUFSSUEgRSBJTkRVU1RSSUFTIEZBRklPIFMuQS4sIEwgPSBUQUNOQSwgQyA9IFBFDQoNCmlzc3Vlcj1DTiA9IExsYW1hLnBlIFNIQTI1NiBTdGFuZGFyZCBDQSwgTyA9IExMQU1BLlBFLCBDID0gUEUNCg0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tDQpNSUlGbmpDQ0JJYWdBd0lCQWdJSUtkNkI5Tzl2aFVvd0RRWUpLb1pJaHZjTkFRRUxCUUF3UmpFa01DSUdBMVVFDQpBd3diVEd4aGJXRXVjR1VnVTBoQk1qVTJJRk4wWVc1a1lYSmtJRU5CTVJFd0R3WURWUVFLREFoTVRFRk5RUzVRDQpSVEVMTUFrR0ExVUVCaE1DVUVVd0hoY05NakV4TWpJeE1UYzFNekV5V2hjTk1qTXhNakl4TVRjMU16QXdXakNDDQpBVHN4UVRBL0JnTlZCQWtNT0VGV0xpQkRTVkpEVlU1V1FVeEJRMGxQVGlCT1QxSlVSU0JNVkM0Z01UUWdUVm91DQpJTU9SSUZWU1FpNGdVa0ZOVDA0Z1EwOVFRVXBCTVNzd0tRWUpLb1pJaHZjTkFRa0JGaHgyWlc1MFlYTmpiM0p3DQpRR3BqYUd4c1lXNTBZWE11WTI5dExuQmxNU3d3S2dZRFZRUUREQ05UVDBaVVYwRlNSU0JFUlNCR1FVTlVWVkpCDQpRMGxQVGlCRlRFVkRWRkpQVGtsRFFURXNNQ29HQTFVRUN3d2pSa0ZEVkZWU1FTQkZURVZEVkZKUFRrbERRU0JTDQpWVU1nTWpBMU1UazJOalkyTURFeElUQWZCZ05WQkFzTUdGWmhiR2xrWVdSdklIQnZjaUJNYkdGdFlTNXdaU0JGDQpVakV0TUNzR0ExVUVDZ3drUVVkU1QxQkZRMVZCVWtsQklFVWdTVTVFVlZOVVVrbEJVeUJHUVVaSlR5QlRMa0V1DQpNUTR3REFZRFZRUUhEQVZVUVVOT1FURUxNQWtHQTFVRUJoTUNVRVV3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBDQpBNElCRHdBd2dnRUtBb0lCQVFDYUYwOGRkOVdwZjBaU3NQYi9QUWRHalFTZi8zdFN3aGVoeGViOU5lcUhlVlZ4DQpHdUxPU0pacEhTK0JHQjJCaGEwMm41WUtheDJKMDlPcnZzc3JOYkkvNm5ycWk4bllSeEZpN3NQSEdrYTZJQUZCDQplNzM5RkpadFNDUHRnZGpNc0JQbGxzNnk2aVNxeGJmOCtkbG84WjdTY0JpM2RzcGFpT2hLWlRyMEdZNWFsMXFIDQp4N0dmNERnbDYrQkJoQlpYVUsvWTczQTZGNm43MU51RUFWK21mVUUyRU9rVWpzYlh0QkJDTnIzd1g3eXBpOFJvDQpGdlJ3TFZyK2IrSS81MDN2aUY2NHFsdDYxMDUxY3VvNFFLY2pINWdmNzBEaEp6SXlQMEgvMWtRby90cnh5TnVuDQozNDk2N0NhcXYzSWpvSTUwR3kvTzNKTktmY0FvTy9RTFNHUGdWak5SQWdNQkFBR2pnZ0dYTUlJQmt6QU1CZ05WDQpIUk1CQWY4RUFqQUFNQjhHQTFVZEl3UVlNQmFBRkYySVc2M3JaZnYrYUtMazJXODlWM0tpN3l1Wk1HY0dDQ3NHDQpBUVVGQndFQkJGc3dXVEExQmdnckJnRUZCUWN3QW9ZcGFIUjBjRG92TDJOeWRDNXNiR0Z0WVM1d1pTOXNiR0Z0DQpZWEJsYzNSaGJtUmhjbVJqWVM1alpYSXdJQVlJS3dZQkJRVUhNQUdHRkdoMGRIQTZMeTl2WTNOd0xteHNZVzFoDQpMbkJsTUNjR0ExVWRFUVFnTUI2QkhIWmxiblJoYzJOdmNuQkFhbU5vYkd4aGJuUmhjeTVqYjIwdWNHVXdSZ1lEDQpWUjBnQkQ4d1BUQTdCZzByQmdFRUFZT1hkd0FCQUFNQk1Db3dLQVlJS3dZQkJRVUhBZ0VXSEdoMGRIQnpPaTh2DQpiR3hoYldFdWNHVXZjbVZ3YjNOcGRHOXllUzh3SFFZRFZSMGxCQll3RkFZSUt3WUJCUVVIQXdJR0NDc0dBUVVGDQpCd01FTURvR0ExVWRId1F6TURFd0w2QXRvQ3VHS1doMGRIQTZMeTlqY213dWJHeGhiV0V1Y0dVdmJHeGhiV0Z3DQpaWE4wWVc1a1lYSmtZMkV1WTNKc01CMEdBMVVkRGdRV0JCU3FndUxPMXBBRjJtSFpGb1ludU0rem1JMnI1VEFPDQpCZ05WSFE4QkFmOEVCQU1DQnNBd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFDS2NLQnI3WW0wUXQyZDhlQU9VDQovM0YwMjVscHVMeE94d2FjN3JlajdZVEZpY2tSaXZkaUVnWUlGSVdRWHNSc0dSbC9pYUJpU3pwQUZtTFM5R3hBDQpKSFIrNzI0Y2FRVU5kZHpYa3VVd2dGRVlGS3NvV3VBM0phaGRsQ0pYNXpOZlNPQXRmaS9BMGhhQWRsUXlNa1VxDQpLVWVocloyampXbng0OFRrTVRGVXlCRWdISXpYcGNGOVExMzZvTytNT0QzeklqR0xaYlQrZHphbGdyT3BpeWdWDQo4dU41WWZKMHpHTU5iUVNWZWF6a3l0bnVMSzRnNXkyRWpYSlBrQkU0aEJrU3B1NWZtTGREYStjZGRUUUlsaVhVDQpjNE1QMTN4aHpIdTFIcUZnQVNwQUtPcDdmd1cyNWdOSW9GQmJqaEsvQjF2dEVPc3UwNkU5emExeDdlVmthRW1SDQpEUUU9DQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tDQpCYWcgQXR0cmlidXRlcw0KICAgIGxvY2FsS2V5SUQ6IEE1IDg4IDkzIDg4IEYwIDgzIDFGIDc1IEIxIENFIDg1IEE3IEQ3IDU0IDg2IEQ5IDg0IDlDIEQ0IEI5IA0KICAgIGZyaWVuZGx5TmFtZTogMjA1MTk2NjY2MDFfMDA1MDk5MTANCktleSBBdHRyaWJ1dGVzOiA8Tm8gQXR0cmlidXRlcz4NCi0tLS0tQkVHSU4gUFJJVkFURSBLRVktLS0tLQ0KTUlJRXZRSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NCS2N3Z2dTakFnRUFBb0lCQVFDYUYwOGRkOVdwZjBaUw0Kc1BiL1BRZEdqUVNmLzN0U3doZWh4ZWI5TmVxSGVWVnhHdUxPU0pacEhTK0JHQjJCaGEwMm41WUtheDJKMDlPcg0KdnNzck5iSS82bnJxaThuWVJ4Rmk3c1BIR2thNklBRkJlNzM5RkpadFNDUHRnZGpNc0JQbGxzNnk2aVNxeGJmOA0KK2RsbzhaN1NjQmkzZHNwYWlPaEtaVHIwR1k1YWwxcUh4N0dmNERnbDYrQkJoQlpYVUsvWTczQTZGNm43MU51RQ0KQVYrbWZVRTJFT2tVanNiWHRCQkNOcjN3WDd5cGk4Um9GdlJ3TFZyK2IrSS81MDN2aUY2NHFsdDYxMDUxY3VvNA0KUUtjakg1Z2Y3MERoSnpJeVAwSC8xa1FvL3RyeHlOdW4zNDk2N0NhcXYzSWpvSTUwR3kvTzNKTktmY0FvTy9RTA0KU0dQZ1ZqTlJBZ01CQUFFQ2dnRUFNMkJRTFpnVjhpU1FjdU8wQnRmM1JBdWluaUlWb1RzN20rR2JLWk8vZFpuNw0KNWZFNzYrR0IzTnd4U1k2YnorS2RKUmhDYzRqUldYSDZJa3BEL1UweStHS2F4dmNDdm95N2ZFdjFsTDNyRlFXMA0KeFh1WGxmazJTb3VDQngrREJJUTByaGtCSStBemg0alMxcE1MYlJVYWlqbDcxRGZVTWlseG9kUnN1cFNHeFNjcg0KQlZ2R0hkNEc4QnovUzVuYUY2TG83eXQySTdia2dzM204WGNpVzRWZGxzemQ1RXdwcFIrdUJlTjBXV1h3V3FGcg0KZENxbEdpTHMzWnNzb1hlaUVtVXppZ0wwRWFUTzRZWG41d1pnMERnMVpBUlVIMzZjT1g1MXhsbTdKbEZKQXFzcQ0KSHFONjJtdkNPbkFadVBldy9odXlrRDA1Zk1La0gzV0RNa09scVFSQmpRS0JnUURUQk1OWkcwWklTVyt1N0ZKWg0KU1NTZC85ZU5IdFFwZmRGWjZ3VmpuS1IzL0hBYVdnVE1zMHRLei9USUdNSXdaeTRvSEM3RStXQkRkNy9sTjVVdA0Ka3ZEUkpxMFVjZkk4by9XcFo1ZGJDODU5ZjhjaGhoZXZ5b1VqbEdyQ24yVmtmU3F4YTNNb2RuNlNpMnNxWVBzLw0KYmpSa2NrU2tpc3M0SThReHl5Nld3NHZFdHdLQmdRQzY4QVc1QUVWTEVRSG1PbU1Uc3ZRZTJmMmo2KzZNZFNEYg0KWitzQ3NuQnIwMVU3cTgvS3JiT3VDQnVUclpONXErUklHYjA0Z3RzMWxSanBXclBkUVBhUmRSZTRDWmxrUlFVNA0KZ211bXE0SXlpT1NDYlFNZUVoUEFxVGJpaUFORGNpVE43aVROUys3K2xLdUFmS3kycHA4TkhHclVrSHRJQ1dxRw0KS2NMQkhwaVFOd0tCZ1FDam5CVE9PTXgwYmFQUEwySGw0a1VtejkvVGhleWZ3dktYMGhZYWxyQWFhN3FMWS9KRw0KdUZrUFIwK1YrVVJPL1NFWGJrcUE1STFUb2p4QnY2ZkZieUdTT0hlSDI1VWltVWwyc0YvMDhxR0dRcFVsays4Mw0KbUVGRVJlWEV3b3Q5cjJKenIwalpQWTZEbHQ5Zk8xUnlhTUxzZ29CZ1IxQ3JWV2ZmNTVaV3hJVFEzd0tCZ0hsWA0KUzUrbVdWUThtZXNEZzBSS0tNUE41Q0gvQnowTTJtTVF0Uzl1L0NKQmIxWG9WRnpQRzQ2Zm5LYmpTSkwxekp3dw0KZU82eG9mREo4djJsN3BKemxKa2VWR01WZUFmcDlWV1U4cU9oT0VYdExjYXJWQmEwelRXRm9TYXgrc3hRenlzTQ0KcGI3TXh6bGc3MkhiaTVDVDN6SDNmREMyQ0EvZWJOTGhVSlZpY3MxSkFvR0FCTjdGek83dFFxVnZQeC9NVTlVNw0KZ0pOeTREdTh6Sm5PeERadjcxbllyM1hYYUpDRTdqRDJBSEZyNU0wYmozMnZ1SUVZOXVIM0pVbWZoTlFCNW92Sg0Ka3Y5YzVrc1hCaXVKVEVnTkkyclV3YzJDYlhHdDFES2pqUHdtMElOVlpmU3BEUDNhb0JXdzFtc2VhT0FvRGRQMw0KenEwREw0S2RvM1ozSlNiVDg0VVcyT3M9DQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0t";
        $requestSign=new RequestSign;
        $requestSign->setCertificadoDigital($sign['CertificadoDigital']);
        $requestSign->setPasswordCertificado($sign['PasswordCertificado']);
        $requestSign->setTramaXmlSinFirma($sign['TramaXmlSinFirma']); 
        $Signer=new Certificar;
        $firmado=$Signer->FirmarXML($requestSign);
        $this->response(array('response' => $firmado), 200);
    }
}
